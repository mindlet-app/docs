---
title: Backend - API Laravel
description: Documentation technique de l'API backend Laravel
sidebar:
  order: 2
---

import { Aside, Badge, Steps, TabItem, Tabs } from '@astrojs/starlight/components';

# ğŸ”§ Backend API Laravel

<Badge text="Laravel 12" variant="success" />
<Badge text="PHP 8.4" variant="caution" />
<Badge text="PostgreSQL" variant="note" />

## PrÃ©sentation

Le backend de Mindlet est une **API RESTful** dÃ©veloppÃ©e avec **Laravel 12**, offrant une interface robuste et sÃ©curisÃ©e pour l'application mobile.

<Aside type="note">
  Nous avons migrÃ© de FastAPI (Python) vers Laravel (PHP) pour bÃ©nÃ©ficier d'un Ã©cosystÃ¨me plus mature et d'une meilleure productivitÃ© de dÃ©veloppement.
</Aside>

## Stack technique

| Composant | Technologie | Version |
|-----------|-------------|---------|
| **Framework** | Laravel | 12.x |
| **Langage** | PHP | 8.4 |
| **Base de donnÃ©es** | PostgreSQL | 17 |
| **Cache** | Redis | 8.2 |
| **Queue** | Laravel Horizon | - |
| **Auth** | Laravel Sanctum | - |

## Architecture du code

```
app
â”œâ”€â”€ Dtos
â”œâ”€â”€ Enums
â”œâ”€â”€ Events
â”œâ”€â”€ Exceptions
â”œâ”€â”€ Filament
â”œâ”€â”€ Http
â”‚   â”œâ”€â”€ Controllers
â”‚   â”œâ”€â”€ Middleware
â”‚   â”œâ”€â”€ Requests
â”‚   â””â”€â”€ Resources
â”œâ”€â”€ Jobs
â”œâ”€â”€ Listeners
â”œâ”€â”€ Models
â”œâ”€â”€ Notifications
â”œâ”€â”€ Policies
â”œâ”€â”€ Providers
â””â”€â”€ Services
```

## Principes d'architecture

### Design Patterns utilisÃ©s

<Tabs>
  <TabItem label="Repository Pattern">
    **Abstraction de la couche donnÃ©es**
    
    ```php
    interface CardRepositoryInterface
    {
        public function findById(int $id): ?Card;
        public function findByCollection(int $collectionId): Collection;
        public function create(array $data): Card;
        public function update(int $id, array $data): Card;
        public function delete(int $id): bool;
    }
    ```
    
    Avantages :
    - DÃ©couplage de la logique mÃ©tier et de la persistance
    - Facilite les tests unitaires (mock des repositories)
    - Permet de changer de source de donnÃ©es sans impacter le code mÃ©tier
  </TabItem>
  
  <TabItem label="Service Layer">
    **Logique mÃ©tier centralisÃ©e**
    
    ```php
    class CardGenerationService
    {
        public function __construct(
            private AIService $aiService,
            private CardRepository $cardRepository,
            private EmbeddingService $embeddingService
        ) {}
        
        public function generateFromDocument(Document $doc): Collection
        {
            $content = $this->extractContent($doc);
            $questions = $this->aiService->generateQuestions($content);
            
            return $this->createCards($questions);
        }
    }
    ```
  </TabItem>
  
  <TabItem label="Form Requests">
    **Validation dÃ©clarative**
    
    ```php
    class CreateCardRequest extends FormRequest
    {
        public function rules(): array
        {
            return [
                'question' => 'required|string|max:1000',
                'answer' => 'required|string|max:5000',
                'collection_id' => 'required|exists:collections,id',
                'type' => 'required|in:flashcard,mcq,truefalse',
            ];
        }
    }
    ```
  </TabItem>
</Tabs>

## Documentation de l'API

L'API est entiÃ¨rement documentÃ©e selon la spÃ©cification **OpenAPI 3.0** grÃ¢ce au package **Scramble**. Celui-ci gÃ©nÃ¨re automatiquement la documentation Ã  partir des routes, contrÃ´leurs et annotations, sans maintenance manuelle.

### Points clÃ©s

- **Autoâ€‘discovery** des endpoints et schÃ©mas depuis le code
- **Documentation OpenAPI** complÃ¨te et versionnÃ©e
- **Interface interactive** intÃ©grÃ©e pour tester les requÃªtes HTTP
- **Sandbox** de test pour valider rapidement les rÃ©ponses
- **Synchronisation continue** : la doc reste alignÃ©e avec lâ€™API

<Aside type="note">
  Le lien vers la documentation complÃ¨te de l'API : [API Docs](https://api.mindlet.app/docs/api)
</Aside>


## SÃ©curitÃ©

### Authentification

<Steps>
1. L'utilisateur s'authentifie avec email/mot de passe
2. L'API gÃ©nÃ¨re un **JWT** avec une durÃ©e de vie limitÃ©e
3. Le client stocke le token de maniÃ¨re sÃ©curisÃ©e
4. Chaque requÃªte inclut le token dans le header `Authorization`
5. Le middleware vÃ©rifie et dÃ©code le token
</Steps>

### Middlewares de sÃ©curitÃ©

```php
// Groupe de middlewares API
Route::middleware([
    'auth:sanctum',      // Authentification JWT
    'throttle:api',      // Rate limiting
    'verified',          // Email vÃ©rifiÃ©
])->group(function () {
    // Routes protÃ©gÃ©es
});
```

### Protection des donnÃ©es

| Mesure | ImplÃ©mentation |
|--------|----------------|
| **Chiffrement** | DonnÃ©es sensibles chiffrÃ©es en base (AES-256) |
| **Hashing** | Mots de passe hashÃ©s avec bcrypt |
| **HTTPS** | TLS 1.3 obligatoire |
| **CORS** | Configuration restrictive |

## Jobs asynchrones

Les tÃ¢ches longues sont exÃ©cutÃ©es de maniÃ¨re asynchrone via **Laravel Horizon** :

```php
class GenerateCardsJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;
    
    public function __construct(
        private Document $document,
        private User $user
    ) {}
    
    public function handle(AIService $aiService): void
    {
        $cards = $aiService->generateCards($this->document);
        
        // Notification Ã  l'utilisateur
        $this->user->notify(new CardsGeneratedNotification($cards));
    }
}
```

### Types de jobs

| Job | Description | PrioritÃ© |
|-----|-------------|----------|
| `GenerateCardsJob` | GÃ©nÃ©ration de cartes via IA | High |
| `ProcessDocumentJob` | Analyse de document uploadÃ© | High |
| `SendNotificationJob` | Envoi de notifications | Low |
| `CleanupJob` | Nettoyage des fichiers temporaires | Low |

## Base de donnÃ©es

### Migrations

Les migrations versionnent le schÃ©ma de la base de donnÃ©es :

```php
Schema::create('cards', function (Blueprint $table) {
    $table->id();
    $table->foreignId('collection_id')->constrained()->cascadeOnDelete();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('type'); // flashcard, mcq, truefalse, etc.
    $table->text('question');
    $table->text('answer');
    $table->json('options')->nullable(); // Pour les QCM
    $table->json('metadata')->nullable();
    $table->timestamps();
    $table->softDeletes();
    
    $table->index(['collection_id', 'type']);
});
```

### ModÃ¨les Eloquent

```php
class Card extends Model
{
    use HasFactory, SoftDeletes;
    
    protected $fillable = [
        'collection_id',
        'user_id',
        'type',
        'question',
        'answer',
        'options',
        'metadata',
    ];
    
    protected $casts = [
        'options' => 'array',
        'metadata' => 'array',
    ];
    
    public function collection(): BelongsTo
    {
        return $this->belongsTo(Collection::class);
    }
    
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
}
```

## Tests

<Badge text="400+ tests" variant="success" />

Notre backend dispose d'une suite complÃ¨te de tests :

```php
class CardControllerTest extends TestCase
{
    use RefreshDatabase;
    
    public function test_user_can_create_card(): void
    {
        $user = User::factory()->create();
        $collection = Collection::factory()->for($user)->create();
        
        $response = $this->actingAs($user)
            ->postJson('/api/v1/cards', [
                'collection_id' => $collection->id,
                'question' => 'What is Laravel?',
                'answer' => 'A PHP framework',
                'type' => 'flashcard',
            ]);
        
        $response->assertStatus(201)
            ->assertJsonStructure([
                'data' => ['id', 'question', 'answer', 'type']
            ]);
    }
}
```

### Couverture des tests

| Type | Nombre | Couverture |
|------|--------|------------|
| **Unit Tests** | 250+ | 85% |
| **Feature Tests** | 150+ | 90% |
| **Integration Tests** | 50+ | - |

---

*API conÃ§ue avec les meilleures pratiques Laravel pour la robustesse et la maintenabilitÃ©.*
