---
title: Backend - API Laravel
description: Documentation technique de l'API backend Laravel
sidebar:
  order: 2
---

import { Aside, Badge, Steps, TabItem, Tabs } from '@astrojs/starlight/components';
import MermaidDownload from '../../../components/MermaidDownload.astro';

# üîß Backend API Laravel

<Badge text="Laravel 12" variant="success" />
<Badge text="PHP 8.4" variant="caution" />
<Badge text="PostgreSQL" variant="note" />

## Pr√©sentation

Le backend de Mindlet est une **API RESTful** d√©velopp√©e avec **Laravel 12**, offrant une interface robuste et s√©curis√©e pour l'application mobile.

<Aside type="note">
  Nous avons migr√© de FastAPI (Python) vers Laravel (PHP) pour b√©n√©ficier d'un √©cosyst√®me plus mature et d'une meilleure productivit√© de d√©veloppement.
</Aside>

## Stack technique

| Composant | Technologie | Version |
|-----------|-------------|---------|
| **Framework** | Laravel | 12.x |
| **Langage** | PHP | 8.4 |
| **Base de donn√©es** | PostgreSQL | 17 |
| **Cache** | Redis | 8.2 |
| **Queue** | Laravel Horizon | - |
| **Auth** | Laravel Sanctum | - |

## Architecture du code

<MermaidDownload title="Structure Laravel">
```mermaid
flowchart TD
    subgraph app["üìÅ app"]
        Dtos[Dtos]
        Enums[Enums]
        Events[Events]
        Exceptions[Exceptions]
        Filament[Filament]
        subgraph Http["üìÅ Http"]
            Controllers[Controllers]
            Middleware[Middleware]
            Requests[Requests]
            Resources[Resources]
        end
        Jobs[Jobs]
        Listeners[Listeners]
        Models[Models]
        Notifications[Notifications]
        Policies[Policies]
        Providers[Providers]
        Services[Services]
    end
    
    style app fill:#f5f5f5,stroke:#333
    style Http fill:#e3f2fd,stroke:#1976d2
```
</MermaidDownload>

## Principes d'architecture

### Design Patterns utilis√©s

<Tabs>
  <TabItem label="Repository Pattern">
    **Abstraction de la couche donn√©es**
    
    ```php
    interface CardRepositoryInterface
    {
        public function findById(int $id): ?Card;
        public function findByCollection(int $collectionId): Collection;
        public function create(array $data): Card;
        public function update(int $id, array $data): Card;
        public function delete(int $id): bool;
    }
    ```
    
    Avantages :
    - D√©couplage de la logique m√©tier et de la persistance
    - Facilite les tests unitaires (mock des repositories)
    - Permet de changer de source de donn√©es sans impacter le code m√©tier
  </TabItem>
  
  <TabItem label="Service Layer">
    **Logique m√©tier centralis√©e**
    
    ```php
    class CardGenerationService
    {
        public function __construct(
            private AIService $aiService,
            private CardRepository $cardRepository,
            private EmbeddingService $embeddingService
        ) {}
        
        public function generateFromDocument(Document $doc): Collection
        {
            $content = $this->extractContent($doc);
            $questions = $this->aiService->generateQuestions($content);
            
            return $this->createCards($questions);
        }
    }
    ```
  </TabItem>
  
  <TabItem label="Form Requests">
    **Validation d√©clarative**
    
    ```php
    class CreateCardRequest extends FormRequest
    {
        public function rules(): array
        {
            return [
                'question' => 'required|string|max:1000',
                'answer' => 'required|string|max:5000',
                'collection_id' => 'required|exists:collections,id',
                'type' => 'required|in:flashcard,mcq,truefalse',
            ];
        }
    }
    ```
  </TabItem>
</Tabs>

## Documentation de l'API

L'API est enti√®rement document√©e selon la sp√©cification **OpenAPI 3.0** gr√¢ce au package **Scramble**. Celui-ci g√©n√®re automatiquement la documentation √† partir des routes, contr√¥leurs et annotations, sans maintenance manuelle.

### Points cl√©s

- **Auto‚Äëdiscovery** des endpoints et sch√©mas depuis le code
- **Documentation OpenAPI** compl√®te et versionn√©e
- **Interface interactive** int√©gr√©e pour tester les requ√™tes HTTP
- **Sandbox** de test pour valider rapidement les r√©ponses
- **Synchronisation continue** : la doc reste align√©e avec l‚ÄôAPI

<Aside type="note">
  Le lien vers la documentation compl√®te de l'API : [API Docs](https://api.mindlet.app/docs/api)
</Aside>


## S√©curit√©

### Authentification

<Steps>
1. L'utilisateur s'authentifie avec email/mot de passe
2. L'API g√©n√®re un **JWT** avec une dur√©e de vie limit√©e
3. Le client stocke le token de mani√®re s√©curis√©e
4. Chaque requ√™te inclut le token dans le header `Authorization`
5. Le middleware v√©rifie et d√©code le token
</Steps>

### Middlewares de s√©curit√©

```php
// Groupe de middlewares API
Route::middleware([
    'auth:sanctum',      // Authentification JWT
    'throttle:api',      // Rate limiting
    'verified',          // Email v√©rifi√©
])->group(function () {
    // Routes prot√©g√©es
});
```

### Protection des donn√©es

| Mesure | Impl√©mentation |
|--------|----------------|
| **Chiffrement** | Donn√©es sensibles chiffr√©es en base (AES-256) |
| **Hashing** | Mots de passe hash√©s avec bcrypt |
| **HTTPS** | TLS 1.3 obligatoire |
| **CORS** | Configuration restrictive |

## Jobs asynchrones

Les t√¢ches longues sont ex√©cut√©es de mani√®re asynchrone via **Laravel Horizon** :

```php
class GenerateCardsJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;
    
    public function __construct(
        private Document $document,
        private User $user
    ) {}
    
    public function handle(AIService $aiService): void
    {
        $cards = $aiService->generateCards($this->document);
        
        // Notification √† l'utilisateur
        $this->user->notify(new CardsGeneratedNotification($cards));
    }
}
```

### Types de jobs

| Job | Description | Priorit√© |
|-----|-------------|----------|
| `GenerateCardsJob` | G√©n√©ration de cartes via IA | High |
| `ProcessDocumentJob` | Analyse de document upload√© | High |
| `SendNotificationJob` | Envoi de notifications | Low |
| `CleanupJob` | Nettoyage des fichiers temporaires | Low |

## Base de donn√©es

### Migrations

Les migrations versionnent le sch√©ma de la base de donn√©es :

```php
Schema::create('cards', function (Blueprint $table) {
    $table->id();
    $table->foreignId('collection_id')->constrained()->cascadeOnDelete();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('type'); // flashcard, mcq, truefalse, etc.
    $table->text('question');
    $table->text('answer');
    $table->json('options')->nullable(); // Pour les QCM
    $table->json('metadata')->nullable();
    $table->timestamps();
    $table->softDeletes();
    
    $table->index(['collection_id', 'type']);
});
```

### Mod√®les Eloquent

```php
class Card extends Model
{
    use HasFactory, SoftDeletes;
    
    protected $fillable = [
        'collection_id',
        'user_id',
        'type',
        'question',
        'answer',
        'options',
        'metadata',
    ];
    
    protected $casts = [
        'options' => 'array',
        'metadata' => 'array',
    ];
    
    public function collection(): BelongsTo
    {
        return $this->belongsTo(Collection::class);
    }
    
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
}
```

## Tests

<Badge text="400+ tests" variant="success" />

Notre backend dispose d'une suite compl√®te de tests :

```php
class CardControllerTest extends TestCase
{
    use RefreshDatabase;
    
    public function test_user_can_create_card(): void
    {
        $user = User::factory()->create();
        $collection = Collection::factory()->for($user)->create();
        
        $response = $this->actingAs($user)
            ->postJson('/api/v1/cards', [
                'collection_id' => $collection->id,
                'question' => 'What is Laravel?',
                'answer' => 'A PHP framework',
                'type' => 'flashcard',
            ]);
        
        $response->assertStatus(201)
            ->assertJsonStructure([
                'data' => ['id', 'question', 'answer', 'type']
            ]);
    }
}
```

### Couverture des tests

| Type | Nombre | Couverture |
|------|--------|------------|
| **Unit Tests** | 250+ | 85% |
| **Feature Tests** | 150+ | 90% |
| **Integration Tests** | 50+ | - |

---

*API con√ßue avec les meilleures pratiques Laravel pour la robustesse et la maintenabilit√©.*
