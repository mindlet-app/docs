---
title: Backend - API Laravel
description: Documentation technique de l'API backend Laravel
sidebar:
  order: 2
---

import { Aside, Badge, Steps, TabItem, Tabs } from '@astrojs/starlight/components';

# ðŸ”§ Backend API Laravel

<Badge text="Laravel 11" variant="success" />
<Badge text="PHP 8.3" variant="note" />
<Badge text="PostgreSQL" variant="caution" />

## PrÃ©sentation

Le backend de Mindlet est une **API RESTful** dÃ©veloppÃ©e avec **Laravel 11**, offrant une interface robuste et sÃ©curisÃ©e pour l'application mobile.

<Aside type="note">
  Nous avons migrÃ© de FastAPI (Python) vers Laravel (PHP) pour bÃ©nÃ©ficier d'un Ã©cosystÃ¨me plus mature et d'une meilleure productivitÃ© de dÃ©veloppement.
</Aside>

## Stack technique

| Composant | Technologie | Version |
|-----------|-------------|---------|
| **Framework** | Laravel | 11.x |
| **Langage** | PHP | 8.3 |
| **Base de donnÃ©es** | PostgreSQL | 16 |
| **Cache** | Redis | 7.x |
| **Queue** | Laravel Horizon | - |
| **Auth** | Laravel Sanctum | JWT |

## Architecture du code

```
app/
â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Controllers/         # ContrÃ´leurs API
â”‚   â”œâ”€â”€ Middleware/          # Middlewares personnalisÃ©s
â”‚   â”œâ”€â”€ Requests/            # Form Requests (validation)
â”‚   â””â”€â”€ Resources/           # API Resources (transformation)
â”œâ”€â”€ Models/                  # ModÃ¨les Eloquent
â”œâ”€â”€ Services/                # Services mÃ©tier
â”œâ”€â”€ Repositories/            # Repositories (abstraction BDD)
â”œâ”€â”€ Jobs/                    # Jobs asynchrones
â”œâ”€â”€ Events/                  # Ã‰vÃ©nements applicatifs
â”œâ”€â”€ Listeners/               # Listeners d'Ã©vÃ©nements
â””â”€â”€ Policies/                # Policies d'autorisation
```

## Principes d'architecture

### Design Patterns utilisÃ©s

<Tabs>
  <TabItem label="Repository Pattern">
    **Abstraction de la couche donnÃ©es**
    
    ```php
    interface CardRepositoryInterface
    {
        public function findById(int $id): ?Card;
        public function findByCollection(int $collectionId): Collection;
        public function create(array $data): Card;
        public function update(int $id, array $data): Card;
        public function delete(int $id): bool;
    }
    ```
    
    Avantages :
    - DÃ©couplage de la logique mÃ©tier et de la persistance
    - Facilite les tests unitaires (mock des repositories)
    - Permet de changer de source de donnÃ©es sans impacter le code mÃ©tier
  </TabItem>
  
  <TabItem label="Service Layer">
    **Logique mÃ©tier centralisÃ©e**
    
    ```php
    class CardGenerationService
    {
        public function __construct(
            private AIService $aiService,
            private CardRepository $cardRepository,
            private EmbeddingService $embeddingService
        ) {}
        
        public function generateFromDocument(Document $doc): Collection
        {
            $content = $this->extractContent($doc);
            $questions = $this->aiService->generateQuestions($content);
            
            return $this->createCards($questions);
        }
    }
    ```
  </TabItem>
  
  <TabItem label="Form Requests">
    **Validation dÃ©clarative**
    
    ```php
    class CreateCardRequest extends FormRequest
    {
        public function rules(): array
        {
            return [
                'question' => 'required|string|max:1000',
                'answer' => 'required|string|max:5000',
                'collection_id' => 'required|exists:collections,id',
                'type' => 'required|in:flashcard,mcq,truefalse',
            ];
        }
    }
    ```
  </TabItem>
</Tabs>

## Endpoints principaux

### Authentification

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/api/v1/auth/register` | Inscription |
| POST | `/api/v1/auth/login` | Connexion |
| POST | `/api/v1/auth/logout` | DÃ©connexion |
| POST | `/api/v1/auth/refresh` | RafraÃ®chir le token |
| GET | `/api/v1/auth/me` | Profil utilisateur |

### Collections

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/v1/collections` | Liste des collections |
| POST | `/api/v1/collections` | CrÃ©er une collection |
| GET | `/api/v1/collections/{id}` | DÃ©tail d'une collection |
| PUT | `/api/v1/collections/{id}` | Modifier une collection |
| DELETE | `/api/v1/collections/{id}` | Supprimer une collection |

### Cartes

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/v1/cards` | Liste des cartes |
| POST | `/api/v1/cards` | CrÃ©er une carte |
| POST | `/api/v1/cards/generate` | GÃ©nÃ©rer via IA |
| GET | `/api/v1/cards/{id}` | DÃ©tail d'une carte |
| PUT | `/api/v1/cards/{id}` | Modifier une carte |
| DELETE | `/api/v1/cards/{id}` | Supprimer une carte |

### Documents

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/api/v1/documents/upload` | Upload de document |
| POST | `/api/v1/documents/analyze` | Analyse par l'IA |
| GET | `/api/v1/documents/{id}` | DÃ©tail du document |

## SÃ©curitÃ©

### Authentification

<Steps>
1. L'utilisateur s'authentifie avec email/mot de passe
2. L'API gÃ©nÃ¨re un **JWT** avec une durÃ©e de vie limitÃ©e
3. Le client stocke le token de maniÃ¨re sÃ©curisÃ©e
4. Chaque requÃªte inclut le token dans le header `Authorization`
5. Le middleware vÃ©rifie et dÃ©code le token
</Steps>

### Middlewares de sÃ©curitÃ©

```php
// Groupe de middlewares API
Route::middleware([
    'auth:sanctum',      // Authentification JWT
    'throttle:api',      // Rate limiting
    'verified',          // Email vÃ©rifiÃ©
])->group(function () {
    // Routes protÃ©gÃ©es
});
```

### Protection des donnÃ©es

| Mesure | ImplÃ©mentation |
|--------|----------------|
| **Chiffrement** | DonnÃ©es sensibles chiffrÃ©es en base (AES-256) |
| **Hashing** | Mots de passe hashÃ©s avec bcrypt |
| **HTTPS** | TLS 1.3 obligatoire |
| **CORS** | Configuration restrictive |
| **Rate Limiting** | 60 requÃªtes/minute par utilisateur |

## Jobs asynchrones

Les tÃ¢ches longues sont exÃ©cutÃ©es de maniÃ¨re asynchrone via **Laravel Horizon** :

```php
class GenerateCardsJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;
    
    public function __construct(
        private Document $document,
        private User $user
    ) {}
    
    public function handle(AIService $aiService): void
    {
        $cards = $aiService->generateCards($this->document);
        
        // Notification Ã  l'utilisateur
        $this->user->notify(new CardsGeneratedNotification($cards));
    }
}
```

### Types de jobs

| Job | Description | PrioritÃ© |
|-----|-------------|----------|
| `GenerateCardsJob` | GÃ©nÃ©ration de cartes via IA | High |
| `ProcessDocumentJob` | Analyse de document uploadÃ© | High |
| `SendNotificationJob` | Envoi de notifications | Low |
| `CleanupJob` | Nettoyage des fichiers temporaires | Low |

## Base de donnÃ©es

### Migrations

Les migrations versionnent le schÃ©ma de la base de donnÃ©es :

```php
Schema::create('cards', function (Blueprint $table) {
    $table->id();
    $table->foreignId('collection_id')->constrained()->cascadeOnDelete();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('type'); // flashcard, mcq, truefalse, etc.
    $table->text('question');
    $table->text('answer');
    $table->json('options')->nullable(); // Pour les QCM
    $table->json('metadata')->nullable();
    $table->timestamps();
    $table->softDeletes();
    
    $table->index(['collection_id', 'type']);
});
```

### ModÃ¨les Eloquent

```php
class Card extends Model
{
    use HasFactory, SoftDeletes;
    
    protected $fillable = [
        'collection_id',
        'user_id',
        'type',
        'question',
        'answer',
        'options',
        'metadata',
    ];
    
    protected $casts = [
        'options' => 'array',
        'metadata' => 'array',
    ];
    
    public function collection(): BelongsTo
    {
        return $this->belongsTo(Collection::class);
    }
    
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
}
```

## Tests

<Badge text="400+ tests" variant="success" />

Notre backend dispose d'une suite complÃ¨te de tests :

```php
class CardControllerTest extends TestCase
{
    use RefreshDatabase;
    
    public function test_user_can_create_card(): void
    {
        $user = User::factory()->create();
        $collection = Collection::factory()->for($user)->create();
        
        $response = $this->actingAs($user)
            ->postJson('/api/v1/cards', [
                'collection_id' => $collection->id,
                'question' => 'What is Laravel?',
                'answer' => 'A PHP framework',
                'type' => 'flashcard',
            ]);
        
        $response->assertStatus(201)
            ->assertJsonStructure([
                'data' => ['id', 'question', 'answer', 'type']
            ]);
    }
}
```

### Couverture des tests

| Type | Nombre | Couverture |
|------|--------|------------|
| **Unit Tests** | 250+ | 85% |
| **Feature Tests** | 150+ | 90% |
| **Integration Tests** | 50+ | - |

---

*API conÃ§ue avec les meilleures pratiques Laravel pour la robustesse et la maintenabilitÃ©.*
