---
title: Performances et scalabilit√©
description: √âvaluation des performances et strat√©gies de mont√©e en charge
sidebar:
  order: 4
---

import { Aside, Badge, Card, CardGrid, TabItem, Tabs } from '@astrojs/starlight/components';

# üìä Performances et scalabilit√©

## √âtat actuel des performances

### M√©triques cl√©s

| M√©trique | Valeur actuelle | Objectif |
|----------|-----------------|----------|
| **Temps de r√©ponse API (p50)** | 45ms | < 100ms |
| **Temps de r√©ponse API (p95)** | 180ms | < 500ms |
| **G√©n√©ration IA (moyenne)** | 8s | < 15s |
| **Uptime** | 99.2% | 99.9% |
| **Utilisateurs simultan√©s** | 100 test√©s | 10 000 cible |

### Benchmarks

<Tabs>
  <TabItem label="API Backend">
    **Endpoint:** `GET /api/v1/collections`  
    **Concurrence:** 50 utilisateurs  
    **Dur√©e:** 60 secondes

    ```mermaid
    xychart-beta
        title "R√©sultats du benchmark API"
        x-axis ["Req/s", "Latence moy (ms)", "P95 (ms)", "P99 (ms)"]
        y-axis "Valeur" 0 --> 500
        bar [450, 42, 156, 312]
    ```

    | M√©trique | Valeur |
    |----------|--------|
    | Requ√™tes/sec | **450** |
    | Latence moyenne | **42ms** |
    | P95 latence | **156ms** |
    | P99 latence | **312ms** |
    | Erreurs | **0%** ‚úÖ |
  </TabItem>
  
  <TabItem label="G√©n√©ration IA">
    **Op√©ration:** G√©n√©rer 10 cartes depuis un document  
    **Taille document:** 5000 mots  
    **Mod√®le:** GPT-4

    ```mermaid
    pie showData
        title "R√©partition du temps de g√©n√©ration"
        "Dur√©e moyenne (8.2s)" : 82
        "Overhead (1.8s)" : 18
    ```

    | M√©trique | Valeur |
    |----------|--------|
    | Dur√©e moyenne | **8.2s** |
    | Tokens utilis√©s | **~3500** |
    | Co√ªt par g√©n√©ration | **~$0.12** |
    | Taux de succ√®s | **98%** ‚úÖ |
  </TabItem>
</Tabs>

## Architecture cloud

![Architecture Cloud](../../../assets/diagrammes/cloud-architecture.png)

### Infrastructure actuelle

| Composant | Configuration | Fournisseur |
|-----------|---------------|-------------|
| **API (Kubernetes)** | 2 pods, 1 CPU, 2GB RAM | OVHcloud |
| **PostgreSQL** | Managed, 2 vCPU, 4GB RAM | OVHcloud |
| **Redis** | Managed, 1GB RAM | OVHcloud |
| **Qdrant** | 1 instance, 2GB RAM | Hetzner |
| **MinIO** | Object storage, 50GB | OVHcloud |

## Strat√©gies de scalabilit√©

### Scalabilit√© horizontale

<CardGrid>
  <Card title="Kubernetes HPA" icon="rocket">
    Auto-scaling des pods API bas√© sur CPU/m√©moire
  </Card>
  <Card title="Load Balancer" icon="random">
    Distribution de charge entre les instances
  </Card>
  <Card title="Stateless Design" icon="setting">
    Chaque pod peut traiter n'importe quelle requ√™te
  </Card>
  <Card title="Queue Workers" icon="list-format">
    Traitement asynchrone des t√¢ches lourdes
  </Card>
</CardGrid>

### Configuration Kubernetes

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mindlet-api
spec:
  replicas: 2
  selector:
    matchLabels:
      app: mindlet-api
  template:
    spec:
      containers:
        - name: api
          image: mindlet/api:latest
          resources:
            requests:
              cpu: "500m"
              memory: "1Gi"
            limits:
              cpu: "1000m"
              memory: "2Gi"
          readinessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 5
            periodSeconds: 10
---
# hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: mindlet-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: mindlet-api
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80
```

### Traitement asynchrone

```php
// Job de g√©n√©ration de cartes
class GenerateCardsJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;
    
    public int $tries = 3;
    public int $timeout = 120;
    
    public function __construct(
        private Document $document,
        private User $user
    ) {
        $this->onQueue('high');
    }
    
    public function handle(AIService $aiService): void
    {
        $cards = $aiService->generateCards($this->document);
        
        event(new CardsGenerated($cards, $this->user));
    }
    
    public function failed(Throwable $exception): void
    {
        Log::error('Card generation failed', [
            'document_id' => $this->document->id,
            'error' => $exception->getMessage(),
        ]);
        
        $this->user->notify(new GenerationFailedNotification());
    }
}
```

## Projections de mont√©e en charge

### Sc√©narios de croissance

| Utilisateurs | API Pods | IA Workers | DB Size | Co√ªt estim√©/mois |
|--------------|----------|------------|---------|------------------|
| **100** (actuel) | 2 | 1 | 5GB | 50‚Ç¨ |
| **1 000** | 4 | 2 | 20GB | 150‚Ç¨ |
| **10 000** | 8 | 4 | 100GB | 500‚Ç¨ |
| **100 000** | 16+ | 8+ | 500GB | 2 000‚Ç¨+ |

### Points de friction identifi√©s

<Aside type="caution">
  Ces points n√©cessitent une attention particuli√®re lors de la mont√©e en charge.
</Aside>

| Composant | Risque | Solution pr√©vue |
|-----------|--------|-----------------|
| **Base de donn√©es** | Connexions satur√©es | Connection pooling (PgBouncer) |
| **Service IA** | Co√ªts LLM | Cache des r√©ponses, mod√®les locaux |
| **Stockage** | Croissance rapide | Politique de r√©tention, compression |
| **Qdrant** | M√©moire insuffisante | Sharding, clustering |

## Optimisations r√©alis√©es

### Cache applicatif

```php
class CollectionController extends Controller
{
    public function index(Request $request): JsonResponse
    {
        $userId = $request->user()->id;
        
        $collections = Cache::remember(
            "user:{$userId}:collections",
            now()->addMinutes(5),
            fn () => Collection::where('user_id', $userId)
                ->with('cards:id,collection_id')
                ->get()
        );
        
        return CollectionResource::collection($collections);
    }
}
```

### Optimisation des requ√™tes

```php
// Avant : N+1 queries
$collections = Collection::all();
foreach ($collections as $collection) {
    echo $collection->cards->count(); // Requ√™te √† chaque it√©ration
}

// Apr√®s : Eager loading
$collections = Collection::withCount('cards')->get();
foreach ($collections as $collection) {
    echo $collection->cards_count; // Pas de requ√™te suppl√©mentaire
}
```

### Indexation base de donn√©es

```sql
-- Index pour les requ√™tes fr√©quentes
CREATE INDEX idx_cards_collection_type ON cards(collection_id, type);
CREATE INDEX idx_cards_user_created ON cards(user_id, created_at DESC);
CREATE INDEX idx_collections_user ON collections(user_id);

-- Index pour la recherche full-text
CREATE INDEX idx_cards_question_gin ON cards 
  USING gin(to_tsvector('french', question));
```

## Monitoring et alertes

### Stack de monitoring

| Outil | Usage |
|-------|-------|
| **Prometheus** | Collecte de m√©triques |
| **Grafana** | Visualisation |
| **Sentry** | Error tracking |
| **Laravel Telescope** | Debug en d√©veloppement |

### M√©triques surveill√©es

```php
// Middleware de m√©triques
class MetricsMiddleware
{
    public function handle($request, $next)
    {
        $start = microtime(true);
        
        $response = $next($request);
        
        $duration = microtime(true) - $start;
        
        Metrics::histogram('http_request_duration_seconds', $duration, [
            'method' => $request->method(),
            'path' => $request->path(),
            'status' => $response->status(),
        ]);
        
        return $response;
    }
}
```

### Alertes configur√©es

| M√©trique | Seuil | Action |
|----------|-------|--------|
| CPU > 80% pendant 5min | Warning | Notification Slack |
| Latency p95 > 1s | Critical | Alerte email + Slack |
| Error rate > 5% | Critical | Alerte imm√©diate |
| Disk usage > 85% | Warning | Notification |

---

*Pr√™t pour la croissance, con√ßu pour la performance.*
